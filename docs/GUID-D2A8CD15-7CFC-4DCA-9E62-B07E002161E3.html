<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

<meta http-equiv="X-UA-Compatible" content="IE=EmulateIE11" /><meta name="copyright" content="(C) Copyright 2022" />
<meta name="DC.rights.owner" content="(C) Copyright 2022" />
<meta name="DC.type" content="topic" />
<meta name="DC.title" content="PMSM FOC using Quadrature Encoder" />
<meta name="DC.relation" scheme="URI" content="GUID-08535D4B-FFA6-47E7-8CAB-2CF0C863DDC4.html" />
<meta name="DC.format" content="XHTML" />
<meta name="DC.identifier" content="pmsm-foc-using-quadrature-encoder" />
<link rel="stylesheet" type="text/css" href="stylesheets/atmel.css" />
<title>PMSM FOC using Quadrature Encoder</title>
<meta name="Microsoft.Help.Id" content="GUID-56C03F44-1868-4538-9045-11B788D32FF7-pmsm-foc-using-quadrature-encoder" />
<meta name="Microsoft.Help.TocParent" content="GUID-56C03F44-1868-4538-9045-11B788D32FF7" />
<meta name="Microsoft.Help.TocOrder" content="0" />
<meta name="Microsoft.Help.Locale" content="en-US" />
<meta name="Microsoft.Help.TopicLocale" content="en-US" />
<meta name="Microsoft.Help.DisplayVersion" content="Microchip MPLABÂ® Harmony 3 Motor Control Application Examples for PIC32MK family Please select a publication type A 08/2022" />
<script language="javascript">
       
       if (window.parent.location.protocol != 'file:') {
				document.addEventListener('click', function(e) {
				    if (e.target) {
               if (e.target.nodeName == "A" ) {
                    if (!e.target.target) {
                      e.preventDefault();
                      e.stopPropagation();
                              
                      var origUrl = window.parent.location.href.substr(0, window.parent.location.href.indexOf("?"));
                      if (origUrl.length === 0) {
                          origUrl = window.parent.location.href;
                      }
                      var href= e.target.getAttribute("href");
                      var parts = href.split("#");
          
                      var url = "";
                      if (parts.length == 2 ) {
                        if (!parts[0].length) {
                            url = window.parent.location.search.replace('?','')
                        } else {
                            url = parts[0].replace('.html','');
                        }
                      } else {
                        url = parts[0].replace('.html','');
                      }

                      if (parts.length == 2) {
                          url += "#" + parts[1];
                      }
    
                      window.parent.location.href = origUrl + "?" + url;

                      return false;
                    }
               }
            }
				});
			}

		</script><script language="javascript">
         
         function copyContent(content, button) {
         
            var textArea = document.createElement("textarea");
            
            // Place in the top-left corner of screen regardless of scroll position.
            textArea.style.position = 'fixed';
            textArea.style.top = 0;
            textArea.style.left = 0;
            
            // Ensure it has a small width and height. Setting to 1px / 1em
            // doesn't work as this gives a negative w/h on some browsers.
            textArea.style.width = '2em';
            textArea.style.height = '2em';
            
            // We don't need padding, reducing the size if it does flash render.
            textArea.style.padding = 0;
            
            // Clean up any borders.
            textArea.style.border = 'none';
            textArea.style.outline = 'none';
            textArea.style.boxShadow = 'none';
            
            // Avoid flash of the white box if rendered for any reason.
            textArea.style.background = 'transparent';
            
            textArea.value = content;
            
            document.body.appendChild(textArea);
            textArea.focus();
            textArea.select();
            
            try {
               var successful = document.execCommand('copy');
               var msg = successful ? 'successful' : 'unsuccessful';
               if (!button.classList.contains("copied")){
                  button.textContent = "Copied";
                  button.classList.add("copied");
                  setTimeout(function(){
                     button.textContent = "Copy";
                     button.classList.remove("copied");
                  },1000);
               }
            } catch (err) {
               console.log('Oops, unable to copy');
            }
            
            document.body.removeChild(textArea);
         }
         
         function cpy(id, button) {
            var element = document.getElementById(id);
            var content = element.getAttribute("content");
            
            copyContent(content, button);
         }
         
         document.addEventListener("DOMContentLoaded", function(event) {
            document.querySelectorAll(".codeblock").forEach(function(elem) {
               elem.style.position = "relative";
               var copy = document.createElement("button");
               copy.textContent = "Copy";
               copy.setAttribute("class", "copy-code");
               
               var content = elem.textContent;
               
               copy.addEventListener("click", function(){
                  copyContent(content, copy);
               });
               
               elem.addEventListener("mouseenter", function(evt){
                  elem.prepend(copy);
               });
            });
            
            document.querySelectorAll(".codeblock").forEach(function(elem) {
               elem.addEventListener("mouseleave", function(evt){
                  document.querySelector(".copy-code").remove();
               });
            });
         });
         
      </script><script language="javascript">
          
          // Add the MathML namespace to html
          var html = document.getElementsByTagName("html")[0],
          head = document.getElementsByTagName("head")[0];
          
          var mathJax = document.createElement("script");
          mathJax.src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-MML-AM_CHTML";
          head.appendChild(mathJax);
          
          html.setAttribute("xmlns:m","http://www.w3.org/1998/Math/MathML");
          
          function inIframe() { try { return window.self !== window.top; } catch (e) { return true; } }
          
          if (!inIframe()) { 
          
          var Default = "index.html?GUID-D2A8CD15-7CFC-4DCA-9E62-B07E002161E3"; 
          
          var displaylocation = "value" + window.location.href;
          
          var GUIDS = displaylocation.split('GUID');          
          
          if (displaylocation.indexOf('#GUID') != -1) {            
          var First = GUIDS[1].split('.html');  
          if (GUIDS[3]){First = GUIDS[2].split('.html');}
          if (GUIDS[4]){First = GUIDS[3].split('.html');}
          if (GUIDS[5]){First = GUIDS[4].split('.html');}
          
          var Second = GUIDS[2].split('#');   
          if (GUIDS[3]){Second = GUIDS[3].split('#');}
          if (GUIDS[4]){Second = GUIDS[4].split('#');}
          if (GUIDS[5]){Second = GUIDS[5].split('#');}
          
          Default = "index.html?" + "GUID" + First[0] + "GUID" + Second[0];     
          }                    
          window.top.location = Default;
          }       
          
        </script><link rel="stylesheet" type="text/css" href="syntax-highlight.css" /><style xml:space="">
        
          button.copy-code{
            display:none;
            padding:0.7em 1.4em;
            margin:0 0.3em 0.3em 0;
            border-radius:0.15em;
            box-sizing: border-box;
            text-decoration:none;
            font-family:'Roboto',sans-serif;
            text-transform:uppercase;
            font-weight:400;
            color:#FFFFFF;
            background-color:#9c9c9c;
            box-shadow:inset 0 -0.6em 0 -0.35em rgba(0,0,0,0.17);
            text-align:center;
            position:relative;
            border: 0;
            float: right;
            border-radius: .5em;
            cursor: pointer;
          }
          button.copy-code:active{
            top:0.1em;
          }
          
          pre:hover button.copy-code{
            display: inline-block !important;
          }
          button.copy-code.copied {
            cursor: default !important;
          }
          
          
          @media all and (max-width:30em){
            button.copy-code{
              display:block;
              margin:0.4em auto;
            }
          }
        
        
      </style><link rel="stylesheet" type="text/css" href="syntax-highlight.css" /></head>
<body id="pmsm-foc-using-quadrature-encoder">
<h1 class="title topictitle1" id="ariaid-title1">PMSM FOC using Quadrature Encoder</h1><div class="body"><p class="p">This example application shows how to control the Permanent Magnet Synchronous Motor (PMSM) with Quadrature Encoder based Field Oriented Control (FOC) on a PIC32MK Micro-controller.</p>
<p class="p"><strong class="ph b">Description</strong></p>
<p class="p">Permanent Magnet Synchronous Motor (PMSM) is controlled using Field Oriented Control (FOC). Rotor position and speed is determined using Quadrature Encoder. Motor start/stop operation is controlled by the switch and motor speed can be changed by the on-board potentiometer. Waveforms and variables can be monitored runtime using X2CScope.</p>
<p class="p">Key features enabled in this project are:</p>
<ul class="ul"><li class="li"><p class="p">Dual shunt current measurement</p>
</li>
<li class="li"><p class="p">Speed control loop</p>
</li>
</ul>
<p class="p"><strong class="ph b">MHC Project Configurations</strong></p>
<br /><img class="image" src="GUID-461A2B83-8EAD-49DE-9D21-934304E122A5-low.jpg" alt="MHC Project Graph" /><br /><ul class="ul"><li class="li"><p class="p"><strong class="ph b">PMSM_FOC</strong>:</p>
<p class="p">This component configures FOC algorithm parameters, motor parameters and motor control board parameters. It connects to underlying peripheral libraries ADCHS and MCPWM. This components auto configures ADC channels and PWM channels as per PMSM_FOC component configurations.</p>
</li>
<li class="li"><p class="p"><strong class="ph b">ADCHS Peripheral</strong>:</p>
<p class="p">The ADCHS is used to measure analog quantities. Four channels are used to measure the Phase Current U, the Phase Current V, the DC Bus Voltage and the Potentiometer. Conversion is triggered at the PWM (zero match + offset of the switch delay)</p>
</li>
<li class="li"><p class="p"><strong class="ph b">MCPWM Peripheral</strong>:</p>
<p class="p">This peripheral is used to generated three phase synchronous PWM waveforms. Fault functionality is also enabled to switch off the output waveforms asynchronously.</p>
</li>
<li class="li"><p class="p"><strong class="ph b">QEI Peripheral</strong>:</p>
<p class="p">This peripheral is used to decode the rotor position and speed from quadrature encoder signals.</p>
</li>
<li class="li"><p class="p"><strong class="ph b">X2CScope</strong>:</p>
<p class="p">This component adds X2C scope protocol code. This uses UART to communicate to the host PC. X2CScope allows user to monitor variables runtime.</p>
</li>
<li class="li"><p class="p"><strong class="ph b">UART Peripheral</strong>:</p>
<p class="p">The UART is used for X2CScope communication to observe graphs and variable values in run time</p>
</li>
</ul>
<p class="p"><strong class="ph b">Project Details</strong>
For details refer <a class="xref" href="https://microchip-mplab-harmony.github.io/motor_control/algorithms/pmsm_foc/mc_plant_docs/introduction.html" target="_blank">Motor Control Plant</a></p>
<p class="p"><strong class="ph b">Development Kits</strong></p>
<p class="p"><strong class="ph b">MCLV2 with PIC32MK Family Motor Control PIM</strong></p>
<p class="p"><strong class="ph b">Downloading and building the application</strong></p>
<p class="p">To clone or download this application from Github, go to the <a class="xref" href="https://github.com/Microchip-MPLAB-Harmony/mc_apps_pic32mk" target="_blank">main page of this repository</a> and then click <strong class="ph b">Clone</strong> button to clone this repository or download as zip file.
This content can also be downloaded using content manager by following these <a class="xref" href="https://github.com/Microchip-MPLAB-Harmony/contentmanager/wiki" target="_blank">instructions</a>.</p>
<p class="p">Path of the application within the repository is <strong class="ph b">apps/mcp_pmsm_foc_encoder_pic32_mk</strong> .</p>
<p class="p">To build the application, refer to the following table and open the project using its IDE.</p>

<div class="tablenoborder"><table cellpadding="4" cellspacing="0" summary="" class="table" frame="border" border="1" rules="all"><col style="width:" /><col style="width:" /><col style="width:" /><thead class="thead" style="text-align:left;"><tr class="row"><th class="entry cellrowborder" style="vertical-align:middle;" id="d1354e119"><span>Project Name</span></th>
<th class="entry cellrowborder" style="vertical-align:middle;" id="d1354e121"><span>Description</span></th>
<th class="entry cellrowborder" style="vertical-align:middle;" id="d1354e123"><span>Demo User Guide</span></th>
</tr>
</thead>
<tbody class="tbody"><tr class="row"><td class="entry cellrowborder" style="vertical-align:middle;" headers="d1354e119 "><span>mclv2_pic32mk_mcf_pim.X</span></td>
<td class="entry cellrowborder" style="vertical-align:middle;" headers="d1354e121 "><span>MPLABX project for MCLV2 board with PIC32MK MCF PIM</span></td>
<td class="entry cellrowborder" style="vertical-align:middle;" headers="d1354e123 "><span><a class="xref" href="GUID-E1D29A62-DCA4-49EC-B3DC-97F4F82E466E.html">MCLV2 with PIC32MK MCF PIM</a></span></td>
</tr>
<tr class="row"><td class="entry cellrowborder" style="vertical-align:middle;" headers="d1354e119 "><span>mclv2_pic32mk_mcm_pim.X</span></td>
<td class="entry cellrowborder" style="vertical-align:middle;" headers="d1354e121 "><span>MPLABX project for MCLV2 board with PIC32MK MCM PIM</span></td>
<td class="entry cellrowborder" style="vertical-align:middle;" headers="d1354e123 "><span><a class="xref" href="GUID-A52365F5-8BB8-4ECE-AE2E-A39AAA916D79.html">MCLV2 with PIC32MK MCM PIM</a></span></td>
</tr>
<tr class="row"><td class="entry cellrowborder" style="vertical-align:middle;" headers="d1354e119 "><span>mclv2_pic32mk_mca_pim.X</span></td>
<td class="entry cellrowborder" style="vertical-align:middle;" headers="d1354e121 "><span>MPLABX project for MCLV2 board with PIC32MK MCA PIM</span></td>
<td class="entry cellrowborder" style="vertical-align:middle;" headers="d1354e123 "><span><a class="xref" href="GUID-B503CDDE-A131-49ED-A821-EB4BECD8AF1D.html">MCLV2 with PIC32MK MCA PIM</a></span></td>
</tr>
<tr class="row"><td class="entry cellrowborder" colspan="3" style="vertical-align:middle;" headers="d1354e119 d1354e121 d1354e123 "><span>Â </span></td>
</tr>
</tbody>
</table>
</div>
<p class="p"><strong class="ph b">MCHV3 with PIC32MK Family Motor Control PIM</strong></p>
<p class="p"><strong class="ph b">Downloading and building the application</strong></p>
<p class="p">To clone or download this application from Github, go to the <a class="xref" href="https://github.com/Microchip-MPLAB-Harmony/mc_apps_pic32mk" target="_blank">main page of this repository</a> and then click <strong class="ph b">Clone</strong> button to clone this repository or download as zip file.
This content can also be downloaded using content manager by following these <a class="xref" href="https://github.com/Microchip-MPLAB-Harmony/contentmanager/wiki" target="_blank">instructions</a>.</p>
<p class="p">Path of the application within the repository is <strong class="ph b">apps/mcp_pmsm_foc_encoder_pic32_mk</strong> .</p>
<p class="p">To build the application, refer to the following table and open the project using its IDE.</p>

<div class="tablenoborder"><table cellpadding="4" cellspacing="0" summary="" class="table" frame="border" border="1" rules="all"><col style="width:" /><col style="width:" /><col style="width:" /><thead class="thead" style="text-align:left;"><tr class="row"><th class="entry cellrowborder" style="vertical-align:middle;" id="d1354e188"><span>Project Name</span></th>
<th class="entry cellrowborder" style="vertical-align:middle;" id="d1354e190"><span>Description</span></th>
<th class="entry cellrowborder" style="vertical-align:middle;" id="d1354e192"><span>Demo User Guide</span></th>
</tr>
</thead>
<tbody class="tbody"><tr class="row"><td class="entry cellrowborder" style="vertical-align:middle;" headers="d1354e188 "><span>mchv3_pic32mk_mcf_pim.X</span></td>
<td class="entry cellrowborder" style="vertical-align:middle;" headers="d1354e190 "><span>MPLABX project for MCHV3 board with PIC32MK MCF PIM</span></td>
<td class="entry cellrowborder" style="vertical-align:middle;" headers="d1354e192 "><span><a class="xref" href="GUID-BF2DBB9A-0522-4EEC-8F11-FA05CDCC3657.html">MCHV3 with PIC32MK MCF PIM</a></span></td>
</tr>
<tr class="row"><td class="entry cellrowborder" style="vertical-align:middle;" headers="d1354e188 "><span>mchv3_pic32mk_mcm_pim.X</span></td>
<td class="entry cellrowborder" style="vertical-align:middle;" headers="d1354e190 "><span>MPLABX project for MCHV3 board with PIC32MK MCM PIM</span></td>
<td class="entry cellrowborder" style="vertical-align:middle;" headers="d1354e192 "><span><a class="xref" href="GUID-58791C0E-DB09-4F93-A34B-143A756C859D.html">MCHV3 with PIC32MK MCM PIM</a></span></td>
</tr>
<tr class="row"><td class="entry cellrowborder" colspan="3" style="vertical-align:middle;" headers="d1354e188 d1354e190 d1354e192 "><span>Â </span></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="related-links">
<div class="familylinks">
<div class="parentlink"><strong>Parent topic:</strong> <a class="link" href="GUID-08535D4B-FFA6-47E7-8CAB-2CF0C863DDC4.html">Motor Control Applications</a></div>
</div>
</div></body>
</html>